https://coursehunter.net/course/devsecops-bootcamp?lesson=47

# IAM Policies:
# Управление IAM Policies в AWS

AWS Identity and Access Management (IAM) предоставляет возможность управлять доступом к AWS ресурсам. Правильная настройка IAM пользователей и политик критически важна для обеспечения безопасности вашей инфраструктуры. В этом документе рассматриваются лучшие практики создания пользователей для AWS Management Console и интеграции с GitLab CI/CD, а также советы по ограничению доступа.

## Основные понятия IAM

- **IAM Users**: Учетные записи, предоставляющие доступ к AWS ресурсам.
- **IAM Roles**: Роли, которые можно назначить временно AWS сервисам, такой как EC2 или Lambda. Роли обычно не привязаны к конкретным пользователям.
- **IAM Policies**: JSON-документы, определяющие разрешения на действия с ресурсами. Политики могут быть привязаны к пользователям, группам или ролям.

## Создание пользователей

### 1. Определите необходимые права доступа

Прежде чем создавать пользователей, важно выяснить, какие права доступа необходимы каждому пользователю:

- **AWS Management Console**: Необходим ли доступ к веб-интерфейсу?
- **GitLab CI/CD**: Необходимы ли ключи доступа для API или AWS CLI?
- **Конкретные действия**: Какую именно функциональность должен иметь пользователь (например, доступ к S3, EC2, Lambda и т.д.)?

### 2. Принципы наименьших привилегий

Одним из основных принципов в безопасности является "наименьшие привилегии". Это значит, что пользователи должны иметь только те права, которые им необходимы для выполнения своих задач. Это снижает риск злоупотребления и минимизирует потенциальный ущерб.

### 3. Использование IAM Groups

Для более легкого управления правами доступа:

- **Создайте группы IAM** для пользователей с аналогичными требованиями к доступу.
- Назначьте политики на уровне группы, чтобы управлять правами на более высоком уровне.

Пример групп и их политик:

- `Developers`: Доступ к EC2, S3, RDS.
- `Admins`: Полный доступ ко всем ресурсам.
- `Viewers`: Только просмотр для специфических ресурсов.

## Политики и разрешения

### 1. Использование встроенных политик

AWS предоставляет множество встроенных политик, которые можно использовать как основы. Например:

- **AmazonS3ReadOnlyAccess**: Предоставляет доступ только для чтения к S3.
- **AmazonEC2FullAccess**: Полный доступ к EC2.

### 2. Написание пользовательских политик

Иногда встроенные политики могут не покрывать ваши требования, и вам нужно создать пользовательские политики. Пример пользовательской политики для ограниченного доступа к S3:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "s3:ListBucket"
            ],
            "Resource": "arn:aws:s3:::example-bucket"
        },
        {
            "Effect": "Allow",
            "Action": [
                "s3:GetObject"
            ],
            "Resource": "arn:aws:s3:::example-bucket/*"
        }
    ]
}
```

### 3. Использование MFA для повышения безопасности

Многофакторная аутентификация (MFA) добавляет дополнительный уровень безопасности:

- Включите MFA для IAM пользователей, особенно для тех, у кого есть доступ к управлению ресурсами.
- Настройте обязательное требование MFA для критически важных действий через политику.

## Best Practices для управления пользователями и политиками

1. **Ограничение сроков доступа**: Используйте временные роли (например, с помощью AWS STS) для обеспечения временного доступа.
2. **Регулярный обзор прав доступа**: Периодически проверяйте права пользователей и групп для обеспечения актуальности.
3. **Логи доступа**: Настройте CloudTrail для ведения журналов всех запросов к API в AWS.
4. **Использование тэгов**: Применяйте теги для ресурсов и пользователей для упрощения мониторинга и управления.
5. **Интеграция с CI/CD**: Для GitLab используйте IAM роли с ограниченными правами. Например, создайте роль с минимальным набором разрешений для выполнения автоматических развертываний или тестов.

## Заключение

Правильное управление пользователями и IAM политиками в AWS — это важный аспект обеспечения безопасности и соблюдения принципов наименьших привилегий. Соблюдение предложенных лучших практик поможет вам защитить вашу инфраструктуру и избежать несанкционированного доступа.

## Полезные ссылки

- [AWS IAM Documentation](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html)
- [Best Practices for IAM Users and Permissions](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)
- [Creating IAM Policies](https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_create.html)

